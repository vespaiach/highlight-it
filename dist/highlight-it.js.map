{
  "version": 3,
  "sources": ["../engines/base.ts", "../utils.ts", "../engines/prism.ts", "../engines/index.ts", "../highlight-it.ts"],
  "sourcesContent": ["/**\n * Prism.js Engine\n * Syntax highlighting engine powered by Prism.js\n */\nexport default abstract class BaseEngine {\n\n    abstract initialize(): Promise<void>;\n\n    abstract highlight(): Promise<void>;\n\n    public appendTo(resource: { tagName: 'script' | 'link'; src: string }, place: 'head' | 'body' = 'head'): Promise<void> {\n        const { tagName, src } = resource;\n\n        let resolve: () => void;\n        let reject: (error: Error) => void;\n        const promise = new Promise<void>((res, rej) => {\n            [resolve, reject] = [res, rej];\n        });\n\n        let element: HTMLScriptElement | HTMLLinkElement;\n        if (tagName === 'link') {\n            element = document.createElement('link');\n            element.rel = 'stylesheet';\n            element.href = src;\n        } else {\n            element = document.createElement('script');\n            element.defer = true;\n            element.src = src;\n        }\n        element.onload = () => {\n            resolve();\n        };\n        element.onerror = () => {\n            reject(new Error(`Failed to load ${tagName}: ${src}`));\n        };\n\n        if (place === 'body') document.body.appendChild(element);\n        else document.head.appendChild(element);\n\n        return promise;\n    }\n\n    /**\n     * Waits for a condition to be met within a timeout period.\n     */\n    public waitUntil(condition: () => boolean, timeout = 15000): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (condition()) {\n                resolve();\n                return;\n            }\n\n            try {\n                const startTime = Date.now();\n                const interval = setInterval(() => {\n                    if (condition()) {\n                        clearInterval(interval);\n                        resolve();\n                    } else if (Date.now() - startTime > timeout) {\n                        clearInterval(interval);\n                        reject(new Error('Highlighting engine failed to load within expected time.'));\n                    }\n                }, 50);\n            } catch (error) {\n                reject(error);\n            }\n        });\n    }\n}\n", "/**\n * Logger utility that respects verbose configuration\n */\nlet verboseMode = false;\n\nexport function setVerbose(enabled: boolean): void {\n    verboseMode = enabled;\n}\n\nexport function log(...args: unknown[]): void {\n    if (verboseMode) {\n        console.log('[highlight-it LOG]: ', ...args);\n    }\n}\n\nexport function warn(...args: unknown[]): void {\n    if (verboseMode) {\n        console.warn('[highlight-it WARN]: ', ...args);\n    }\n}\n\nexport function error(...args: unknown[]): void {\n    // Errors are always shown regardless of verbose mode\n    console.error('[highlight-it ERROR]: ', ...args);\n}\n", "import BaseEngine from './base';\nimport { log, warn, error as logError } from '../utils';\nimport type { CustomConfig, Resource } from '../type';\n\nconst URL_PREFIX = 'https://cdn.jsdelivr.net/gh/PrismJS/prism@1.30.0';\n// Define the plugins to be used and their dependencies\nconst PLUGINS = [\n    ['autoloader', false],\n    ['toolbar', true],\n    ['copy-to-clipboard', false],\n    ['line-numbers', true],\n    ['line-highlight', true]\n];\n\nconst BUILT_IN_THEMES = ['coy', 'dark', 'funky', 'okaidia', 'solarizedlight', 'tomorrow', 'twilight', 'prism'];\n\n/**\n * Prism.js Engine\n * Syntax highlighting engine powered by Prism.js\n */\nexport default class PrismEngine extends BaseEngine {\n    private resources: Resource[] = [];\n\n    constructor(config: CustomConfig) {\n        super();\n        const { theme, darkMode } = config;\n\n        this.setTheme(theme, darkMode || '');\n        this.setPlugins();\n    }\n\n    async initialize() {\n        // Stop Prism from auto-highlighting\n        if (!window.Prism) {\n            window.Prism = { manual: true };\n        } else {\n            window.Prism.manual = true;\n        }\n\n        try {\n            // Add core script\n            await this.appendTo({ tagName: 'script', src: `${URL_PREFIX}/components/prism-core.min.js` }, 'body');\n            await this.waitUntil(() => !!window.Prism?.filename);\n            log('Core script loaded.');\n\n            // Load all resources\n            await Promise.all([\n                ...this.resources.map((r) => this.appendTo(r, r.tagName === 'link' ? 'head' : 'body')),\n                this.waitUntil(() => !!window.Prism?.plugins?.autoloader)\n            ]);\n            log('[Prism Engine] All resources loaded.', this.resources);\n        } catch (er) {\n            logError('Error during initialization:', er);\n        }\n    }\n\n    setTheme(theme: string, darkMode: string) {\n        const addToResource = (name: string) => {\n            this.resources.push({\n                tagName: 'link',\n                src: `${URL_PREFIX}/themes/${name === 'prism' ? 'prism' : `prism-${name}`}.min.css`\n            });\n        };\n\n        if (darkMode && BUILT_IN_THEMES.includes(darkMode)) {\n            const isDarkMode = window.matchMedia?.('(prefers-color-scheme: dark)').matches;\n            addToResource(darkMode);\n            log(\n                `[Prism Engine] Dark mode theme \"${darkMode}\" will be applied automatically based on system preference (currently ${\n                    isDarkMode ? 'dark' : 'light'\n                } mode).`\n            );\n        } else if (BUILT_IN_THEMES.includes(theme)) {\n            addToResource(theme);\n        } else {\n            addToResource('prism');\n            warn(`[Prism Engine] Theme \"${theme}\" is not supported.`);\n        }\n    }\n\n    setPlugins() {\n        // Add plugin CSS\n        PLUGINS.forEach((plugin) => {\n            const [pluginName, needCss] = plugin;\n            if (needCss) {\n                this.resources.push({\n                    tagName: 'link',\n                    src: `${URL_PREFIX}/plugins/${pluginName}/prism-${pluginName}.min.css`\n                });\n            }\n\n            this.resources.push({\n                tagName: 'script',\n                src: `${URL_PREFIX}/plugins/${pluginName}/prism-${pluginName}.min.js`\n            });\n        });\n\n        // Add line-numbers class\n        document.body.classList.add('line-numbers');\n    }\n\n    async highlight() {\n        window.Prism?.highlightAll?.();\n    }\n}\n", "import PrismEngine from \"./prism.js\";\n\nexport {\n    PrismEngine\n    // Future engines:\n    // highlightjs: () => import('./highlightjs.js'),\n    // shiki: () => import('./shiki.js'),\n};\n", "/**\n * highlight-it - Main entry point\n * Parses script URL parameters and initializes the highlighting engine\n */\n\nimport { PrismEngine } from './engines';\nimport type { CustomConfig } from './type';\nimport { log, setVerbose, error as logError, warn } from './utils';\n\n(async () => {\n    // Only run in browser environment\n    if (typeof document === 'undefined') {\n        return;\n    }\n\n    // Guard against multiple executions\n    if (window.__highlightItInitialized) {\n        return;\n    }\n    window.__highlightItInitialized = true;\n\n    /**\n     * Parses configuration from the script's URL parameters\n     * Extracts 'pack' and 'darkmode' parameters\n     */\n    function parseScriptParams() {\n        const scriptElement = document.currentScript;\n\n        // Default configuration\n        const config: CustomConfig & { verbose: boolean } = {\n            theme: 'prism',\n            darkMode: '',\n            verbose: false\n        };\n\n        // Parse URL parameters if script element is available\n        if (scriptElement && scriptElement instanceof HTMLScriptElement && scriptElement.src) {\n            try {\n                const url = new URL(scriptElement.src);\n\n                // Get pack parameter (config or pack)\n                config.theme = url.searchParams.get('theme') || url.searchParams.get('config') || 'prism';\n\n                // Get darkmode parameter\n                config.darkMode = url.searchParams.get('darkmode') || url.searchParams.get('darkMode');\n\n                // Get verbose parameter\n                const verboseParam = url.searchParams.get('verbose');\n                if (verboseParam) {\n                    config.verbose = ['true', '1', 'yes', 'on'].includes(verboseParam.toLowerCase());\n                }\n            } catch (error) {\n                warn('Failed to parse script URL:', error);\n                return config;\n            }\n        }\n\n        return config;\n    }\n\n    // ==================== Main Execution ====================\n    try {\n        const { theme, darkMode, verbose } = parseScriptParams();\n        setVerbose(verbose);\n\n        log('highlight-it initialized with config:', { theme, darkMode, verbose });\n\n        // Load the engine (currently only Prism.js is supported)\n        const engine = new PrismEngine({ theme, darkMode });\n\n        // Initialize the engine with parsed configuration\n        await engine.initialize();\n\n        // Trigger syntax highlighting\n        await engine.highlight();\n\n        log('highlight-it: Code highlighting completed');\n    } catch (err) {\n        logError('highlight-it error:', err);\n    }\n})();\n"],
  "mappings": "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",
  "names": ["BaseEngine", "init_base", "__esmMin", "resource", "place", "tagName", "src", "resolve", "reject", "promise", "res", "rej", "element", "condition", "timeout", "startTime", "interval", "error", "setVerbose", "enabled", "verboseMode", "log", "args", "warn", "error", "init_utils", "__esmMin", "URL_PREFIX", "PLUGINS", "BUILT_IN_THEMES", "PrismEngine", "init_prism", "__esmMin", "init_base", "init_utils", "BaseEngine", "config", "theme", "darkMode", "_a", "log", "r", "_b", "er", "error", "addToResource", "name", "isDarkMode", "warn", "plugin", "pluginName", "needCss", "init_engines", "__esmMin", "init_prism", "require_highlight_it", "__commonJSMin", "init_engines", "init_utils", "parseScriptParams", "scriptElement", "config", "url", "verboseParam", "error", "warn", "theme", "darkMode", "verbose", "setVerbose", "log", "engine", "PrismEngine", "err"]
}
